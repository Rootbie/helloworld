node{
    stage('1. Clone new project'){
        sh "git clone https://github.com/Rootbie/helloworld.git"
    }

    stage('2. Maven build'){
        sh "mvn clean package -f helloworld/pom.xml"
    }

    stage('3. Build Docker image'){
        sh "docker build -t trinh00thien/demo-hello:v2 helloworld"
    }

    stage('4. Remove container'){
        sh "docker rm -f cnt-hello"
    }

    stage('5. Deploy Docker image to Tomcat'){
        sh "docker run -p 23456:8080 -d --name cnt-hello trinh00thien/demo-hello:v2"
    }

    stage('6. Upload Docker to Docker repo'){
        // Jenkins may require Docker login credentials
        withCredentials([string(credentialsId: 'docker-login_secret-text', variable: 'docker-dangnhap')])  {
            sh "docker login -u trinh00thien -p ${docker-dangnhap}"
        }
        sh "docker push trinh00thien/demo-hello:v2"
    }
}
